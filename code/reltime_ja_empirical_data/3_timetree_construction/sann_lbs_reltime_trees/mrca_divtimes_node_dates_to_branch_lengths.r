
#################################################################################
#################################################################################
######### reads tree and list of nodes and cimmpute branch lengths ##############
rm(list=ls())
require(treeio)
require(ips)
require(ape)
source(file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees/nodeDates2branchLengths.r")
b <- read.tree(file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees/final_lbs_tree_rooted_no_outgroup.nwk")
times = c(1.900340394,1.558018506,1.530845582,1.494631704,1.282872521,1.219833119,1.144938321,0.868037815,0.824338221,0.700977155,0.590088187,0.577665162,0.531167855,0.487759475,0.054556634,0.046835209,0.029770902,0.047160739,0.046241214,0.444428227,0.415219496,0.379509576,0.007612799,0.296411777,0.460567966,0.392933607,0.369007109,0.508987481,0.454017347,0.411802453,0.37374771,0.28268643,0.240215423,0.147387939,0.236375668,0.767198596,0.714383034,0.519350055,0.428826505,0.379017659,0.133713402,0.089825619,0.200171163,0.628317808,0.492608399,0.610005011,0.281627036,0.733363606,0.55373509,0.198218016,1.078068176,0.569438782,0.463825208,0.249267235,1.21507568,0.988474812,0.960168813,0.920979042,0.255048147,0.194724174,0.032266607,0.291892628,0.573126611,0.192111936,1.125765036,0.821652954,0.626176286,0.539966836,0.496106783,0.558496852,0.542853159,0.4744102,0.24270406,0.153623119,1.439371384,1.372753393,1.120963697,1.065508396,1.020997855,0.803325986,0.549786433,0.493700426,0.396081392,0.269264838,0.239115786,0.29239137,0.432703343,0.227362122,0.206188826,0.681838842,0.472256142,0.093792752,0.080465254,0.195429293,0.961205819,0.410334289,0.37504836,0.343126927,0.226410083,0.373553692,0.144301224,0.066395454,0.055334853,0.757883705,0.510014492,0.437279664,1.205430777,0.549132358,0.491321719,0.387182338,0.823232338,1.411440953,1.372047719,0.97346697,0.856614192,0.679316252,0.446423601,0.403319606,0.375069684,0.322111225,0.289677391,0.280277447,0.169429195,0.146081733,0.099333714,0.03477225,0.051378563,0.152628512,0.111427501,0.177842524,0.118091279,0.068037137,0.155689648,0.319156732,0.707134535,0.695833034,0.670811037,0.476645791,0.452036821,0.397286547,0.380596484,0.040745913,0.291865674,0.187416962,0.140348524,0.104218443,0.569340688,0.664032707,0.375562918,0.13318005,0.200111325,0.505294084,0.732103821,0.618056252,0.559059083,0.508144978,0.341712069,0.210530952,0.197354779,0.043183214,0.174072372,0.151668534,0.086744451,0.093682136,0.52404986,0.494140189,0.440794659,0.190554209,0.015522385,0.132860343,0.30488199,0.250810391,1.761985225,0.425811366,0.269855416)
names(times) = c("177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351")
chronoRedux <- nodeDates2branchLengths(tree=b, nodeDates=times, allTipsModern=TRUE)
write.tree(chronoRedux, file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees/mrca_node_divtimes_timetree.nwk")






#################################################################################
#################################################################################
######### reads tree and list of nodes and cimmpute branch lengths ##############

# lets do the same thing but with nodeDates2branchLengths
# can use branching.times from ape 
	# (but only for ultrametric trees!)
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = branchingTimes, allTipsModern = TRUE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# now lets try with dateNodes in paleotree
nodeTimes <- dateNodes(chrono)
# need to use allTipsModern = FALSE because tip ages are included
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = nodeTimes, allTipsModern = FALSE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# get just the node times (remove tip dates)
nodeOnlyTimes <- nodeTimes[-(1:Ntip(chrono))]
# let's use the allTipsModern = TRUE setting
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = nodeOnlyTimes, allTipsModern = TRUE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# did all tests come out as TRUE?
if(!all(tests)){stop("nodeDates2branchLengths isn't functioning correctly")}

