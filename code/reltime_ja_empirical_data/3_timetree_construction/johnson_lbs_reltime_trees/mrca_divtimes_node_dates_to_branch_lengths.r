
#################################################################################
#################################################################################
######### reads tree and list of nodes and cimmpute branch lengths ##############
rm(list=ls())
require(treeio)
require(ips)
require(ape)
source(file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees/nodeDates2branchLengths.r")
b <- read.tree(file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/johnson_lbs_reltime_trees/final_lbs_tree_rooted_no_outgroup.nwk")
times = c(4.450186739,4.36636582,4.089797369,3.70386872,3.41079747,2.554101586,2.429104233,2.195191014,1.991686148,1.42501477,1.109629459,0.893682858,0.634270373,0.610996326,0.570191799,0.229778073,0.529214571,0.276645068,0.123904087,0.080378387,0.859472696,0.63998889,0.487888149,0.562781551,0.013123217,0.581641156,0.519926119,0.477309394,0.453839222,0.404626836,0.419161545,0.492941666,0.181284039,0.857308396,1.795767968,1.638821219,1.35486092,0.599180316,0.476597514,0.29528308,1.095888084,0.760672401,0.742481631,1.261647338,1.097708391,0.711133513,1.934495794,1.82729122,1.659261976,1.239750436,1.085345542,0.87084152,1.112098007,1.21821405,0.602495421,0.250843463,2.302672707,1.675459012,1.589081684,0.740941975,0.614806468,0.111991164,2.152996702,3.196028751,2.941684846,2.381379916,1.706798863,1.072327404,0.911688588,0.887328256,0.748724062,0.420516735,0.393312879,0.163627818,0.250861757,0.299118413,0.704995692,0.763446566,0.672659201,1.001023224,2.128684513,0.747830123,0.616678437,0.638813625,0.49369769,1.89447859,1.085803937,0.930873116,0.828004423,0.734117409,0.447519624,0.686587523,0.489087873,0.243834278,1.321412342,0.943395544,1.052896166,0.818050278,0.309141688,3.32234567,3.192666045,2.778201952,1.385492095,1.175292953,1.004339652,0.593090565,0.251470824,0.386994613,0.222987612,0.441198935,0.591901728,0.312549858,0.263003656,0.106170915,0.16469523,1.511015202,0.974175261,0.834870586,0.687621842,0.539321594,0.437012633,0.297955677,0.615704374,2.78787224,1.887777139,1.50366728,0.916894336,0.639815608,0.928828789,0.392965355,4.272669459,2.842041253,2.636180186,1.643673879,1.228340949,1.177907497,1.123992686,0.435169972,0.890744933,1.151571064,0.788011544,0.692137232,0.441935979,1.5584319,1.060412836,0.735425722,0.516289845,1.508027647,1.105284407,2.183805172,1.680504635,1.474004189,1.185556063,0.923860892,0.703064985,0.604083537,0.510656181,0.463144366,0.380748751,1.141652423,1.592870563,3.697430816,2.796706675,2.119812438,1.828826215,1.372343911,1.012631412,2.435813873,1.738886432,1.825996586,1.391423931,3.983091216,3.692681132,3.507394882,3.30669965,3.051469521,2.606369744,2.145182632,2.504675677,2.479276722,1.78138092,1.187218361,0.924764607,2.173192563,3.018654998,3.74964992,1.507844062)
names(times) = c("189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351","352","353","354","355","356","357","358","359","360","361","362","363","364","365","366","367","368","369","370","371","372","373","374","375")
chronoRedux <- nodeDates2branchLengths(tree=b, nodeDates=times, allTipsModern=TRUE)
write.tree(chronoRedux, file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/johnson_lbs_reltime_trees/mrca_node_divtimes_timetree.nwk")






#################################################################################
#################################################################################
######### reads tree and list of nodes and cimmpute branch lengths ##############

# lets do the same thing but with nodeDates2branchLengths
# can use branching.times from ape 
	# (but only for ultrametric trees!)
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = branchingTimes, allTipsModern = TRUE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# now lets try with dateNodes in paleotree
nodeTimes <- dateNodes(chrono)
# need to use allTipsModern = FALSE because tip ages are included
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = nodeTimes, allTipsModern = FALSE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# get just the node times (remove tip dates)
nodeOnlyTimes <- nodeTimes[-(1:Ntip(chrono))]
# let's use the allTipsModern = TRUE setting
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = nodeOnlyTimes, allTipsModern = TRUE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# did all tests come out as TRUE?
if(!all(tests)){stop("nodeDates2branchLengths isn't functioning correctly")}

