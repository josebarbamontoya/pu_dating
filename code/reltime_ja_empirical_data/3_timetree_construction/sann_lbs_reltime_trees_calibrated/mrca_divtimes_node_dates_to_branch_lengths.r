
#################################################################################
#################################################################################
######### reads tree and list of nodes and cimmpute branch lengths ##############
rm(list=ls())
require(treeio)
require(ips)
require(ape)
source(file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees_calibrated/nodeDates2branchLengths.r")
b <- read.tree(file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees_calibrated/final_lbs_tree_rooted_no_outgroup.nwk")
times = c(178.9714711,151.420449,149.3034773,146.4396862,129.9467235,125.6250173,119.1339702,95.46587962,92.05266984,83.32185408,76.0535203,75.29129535,71.00802286,65.27252643,8.116182707,7.187648826,4.649628776,7.081345133,6.938897758,59.49549487,60.25861441,57.12373744,0.487663884,50.07852653,68.66485751,63.34364113,60.20708857,59.81323887,53.39687771,48.52319604,44.17809139,34.46961122,29.29237472,17.41915061,27.87215083,85.67463315,79.93730413,58.5018229,48.81208193,42.23383984,14.71846492,9.883225866,22.54417741,70.66423533,55.46290276,67.62460673,31.18618682,79.77548886,60.23576124,20.62139882,110.8987004,58.67971145,48.40994855,25.99992303,123.5536713,100.8961531,98.03670699,94.07996183,27.94328091,21.29555461,3.285858239,29.83450244,60.09789968,20.12369149,114.8448933,85.19887408,63.9625955,55.16585673,50.67231828,57.90485936,53.46168515,46.64823467,25.94203928,16.61370941,141.3075736,134.9795514,109.9310069,104.5321176,100.0856001,78.26881927,53.91470805,48.54747517,39.39818849,27.05319874,24.01211703,28.76412356,42.40205637,22.31900656,20.27371266,65.31981366,45.43483863,10.20428992,8.520151965,18.80989327,94.29245285,40.94807892,37.50378309,34.38919093,22.62507794,37.17195784,15.29149166,7.023773125,5.420397238,74.82859063,50.04216465,42.59886844,118.6229241,54.39497777,48.7387444,38.32619884,80.96990786,138.9335774,135.5647228,102.6606314,91.168409,73.89247384,51.6970074,47.40261561,44.83401005,39.43369497,35.73138415,34.59495549,20.70375366,17.80448689,12.15796591,3.715608305,6.275572582,18.73662741,13.38241921,21.52653085,13.88410385,8.002075165,19.09976333,34.7125845,76.31158022,75.22932012,72.54276244,51.60427412,48.90124835,42.86812991,40.95267572,4.383704802,31.44584221,20.27207747,15.89283669,11.79898269,61.57940833,72.1176762,40.81995575,14.49318445,21.75331455,54.52084761,78.56166192,67.6050867,61.14050809,55.52605542,37.3670488,23.01454982,21.54678681,4.724285905,18.68092935,16.11532102,9.209774125,10.04545218,55.78460339,52.61781183,46.97472533,21.45573167,1.742474396,14.14541885,30.95216802,25.81389414,165.6566457,39.93382625,25.53633258)
names(times) = c("177","178","179","180","181","182","183","184","185","186","187","188","189","190","191","192","193","194","195","196","197","198","199","200","201","202","203","204","205","206","207","208","209","210","211","212","213","214","215","216","217","218","219","220","221","222","223","224","225","226","227","228","229","230","231","232","233","234","235","236","237","238","239","240","241","242","243","244","245","246","247","248","249","250","251","252","253","254","255","256","257","258","259","260","261","262","263","264","265","266","267","268","269","270","271","272","273","274","275","276","277","278","279","280","281","282","283","284","285","286","287","288","289","290","291","292","293","294","295","296","297","298","299","300","301","302","303","304","305","306","307","308","309","310","311","312","313","314","315","316","317","318","319","320","321","322","323","324","325","326","327","328","329","330","331","332","333","334","335","336","337","338","339","340","341","342","343","344","345","346","347","348","349","350","351")
chronoRedux <- nodeDates2branchLengths(tree=b, nodeDates=times, allTipsModern=TRUE)
write.tree(chronoRedux, file="/Users/barba/Desktop/lbs_iqtree_reltime_timetrees/lbs-reltime_ultimate_timetrees/sann_lbs_reltime_trees_calibrated/mrca_node_divtimes_timetree.nwk")






#################################################################################
#################################################################################
######### reads tree and list of nodes and cimmpute branch lengths ##############

# lets do the same thing but with nodeDates2branchLengths
# can use branching.times from ape 
	# (but only for ultrametric trees!)
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = branchingTimes, allTipsModern = TRUE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# now lets try with dateNodes in paleotree
nodeTimes <- dateNodes(chrono)
# need to use allTipsModern = FALSE because tip ages are included
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = nodeTimes, allTipsModern = FALSE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# get just the node times (remove tip dates)
nodeOnlyTimes <- nodeTimes[-(1:Ntip(chrono))]
# let's use the allTipsModern = TRUE setting
chronoRedux <-  nodeDates2branchLengths(tree = notChrono,
    nodeDates = nodeOnlyTimes, allTipsModern = TRUE)
# test that its the same
(tests <- c(tests,all.equal.numeric(chrono$edge.length,chronoRedux$edge.length)))

# did all tests come out as TRUE?
if(!all(tests)){stop("nodeDates2branchLengths isn't functioning correctly")}

